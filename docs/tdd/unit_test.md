## 单元测试的粒度设计

### 粒度大的单元测试：测功能

#### 优点：

1. 业务/接口不变的情况下，重构代码，不需要改测试（保证功能不被重构代码破坏）
2. 标题可与需求、QA测试点对应起来，容易理解
3. 保证各个部件配合起来不出错

#### 缺点：

1. 干扰多，需要 mock 的依赖比较多
2. 运行时间比较长

### 粒度小的单元测试：测文件/类/方法/纯函数/正则表达式...

1. 重构时可能会被改写或者删除
2. 技术向的标题描述
3. 依赖较少
4. 速度快

### 大粒度结合小粒度

1. 大粒度覆盖主干功能，小粒度覆盖特殊分支（edge cases）
2. 可复用模块进行独立的小粒度测试，不与某一具体业务绑定（测试模块自身的各种可能的输入输出）
3. 大粒度测试与QA的测试点对应

## 单元测试的可靠性

1. 让测试在该 fail 的 时候 fail, 该 pass 的时候 pass
2. 测试的输入输出应该是稳定的，任何时候任何环境下都一样。（排除到一切不确定因素的干扰）
3. 测试隔离，测试之间不能互相依赖或互相影响
4. 避免 mock 自身内部实现
5. 尝试在开发过程中用 UT来取代手动测试

## 单元测试的可维护性

1. 避免直接测试私有方法/属性（私有方法在重构时往往会被合并、拆分、删除，如果这些操作需要更改对应的UT, 会增加很多的工作量）
2. 减少重复代码
3. 测试代码的复杂度应该低于对应的功能实现（适当保留重复，测试代码本身不宜有过多的抽象和逻辑）
4. 善于使用测试框架提供的断言API, 提高可读性
